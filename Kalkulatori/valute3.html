<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title></title>
</head>
<body>

<div class="container">

    <h1>Kalkulator - Konverter valuta</h1>

    <div class="box">
        <div class="left-box">
            <select name="currency" class="currency"></select>
            <input type="number" name="" id="unos">
        </div>
        <div class="right-box">
            <select name="currency" class="currency"></select>
            <input type="number" name="" id="rezultat" disabled>
        </div>
    </div>
    <button class="btn" id="izracunaj"> Konvertuj</button>
</div>

<script>
    const select = document.querySelectorAll(".currency");
    const izracunaj = document.getElementById("izracunaj");
    const unos = document.getElementById("unos");
    const rezultat = document.getElementById("rezultat");

    fetch('https://openexchangerates.org/api/currencies.json')
        .then((data) => data.json())
        .then((data) => {
            display(data);
        });

    function display(data) {
        const entries = Object.entries(data);
        for (var i = 0; i < entries.length; i++) {
            select[0].innerHTML += `<option value = "${entries[i][0]}" > ${entries[i][0]} </option>`;
            select[1].innerHTML += `<option value = "${entries[i][0]}" > ${entries[i][0]} </option>`;
        }
    }

    izracunaj.addEventListener("click", () => {
        let valuta1 = select[0].value;
        let valuta2 = select[1].value;
        let value = unos.value;

        if (valuta1 != valuta2) {
            konvertuj(valuta1, valuta2, value);
        } else {
            alert("Izaberite različite valute.")
        }
    });

    function konvertuj(valuta1, valuta2, value) {
        const host = "https://v6.exchangerate-api.com/v6/6e945d40826f1bed44e2bd05/latest";
        fetch(
            `${host}/${valuta1}`)

            .then((res) => res.json())
            .then((res) => {
				let konacniRezultat = value * GetPropertyValue(res.conversion_rates, valuta2);
                rezultat.value = konacniRezultat;
            });
    }

    function GetPropertyValue(obj1, dataToRetrieve) {
        return dataToRetrieve
            .split('.') // split string based on `.`
            .reduce(function (o, k) {
                return o && o[k]; // get inner property if `o` is defined else get `o` and return
            }, obj1) // set initial value as object
    }

</script>

</body>
</html>